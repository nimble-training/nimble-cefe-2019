---
title: "Occupancy Model with `dOcc` Distribution"
output: html_document
---

---

\   



### Using `dOcc` distribution

Now we're going to try the occupancy model again, but this time use the `dOcc` distribution from the `nimbleEcology` package.


\   

### Static Occupancy Models: `dOcc` distribution

For **static** occupancy models, where we assume there is no colonization or departures from sites, we use a version of the `dOcc` distribution.  That is, we're assuming each site is either occupied, or un-occupied, for the duration of our sampling.

The two versions of the `dOcc` distribution differ in whether detection probability depends on time, or not:

- `dOcc_s`: Detection probability is time-independent (scalar).
- `dOcc_v`: Detection probability is time-dependent (vector).

\   

**Question**: Which version do we want to use, for updating our occupancy model?

\  

### Dynamic Occupancy Models: `dDynOcc` distribution

In **dynamic** occupancy models, we assume the true "occupied" status of each site may change, during the course of our study.  Generally, there are multiple seasons (primary periods), in each of which there were multiple sampling occasions (secondary periods), at each of multiple sites.

There are actually **12** different versions of the `dDynOcc` distribution available in `nimbleEcology`!  These differ in whether persistence, colonization, and detection probabilities are time dependent, or not.

The distributions are named by `dDynOcc_` followed by three letters. Each letter indicates the typing (or dimension) of the persistence, colonization, and detection probabilities, respectively:

- `dDynOcc_s**` functions take time-independent (scalar) persistence probabilities, while `dDynOcc_v**`functions take time-dependent (vector) persistence probabilities
- `dDynOcc_*s*` functions take time-independent (scalar) colonization probabilities, while `dDynOcc_*v*`functions take time-dependent (vector) colonization probabilities
- `dDynOcc_**s` functions take time-independent (scalar) observation probabilities, while `dDynOcc_**v` functions take observation probabilities dependent on time step (vector) and `dDynOcc_**m` functions take observation probabilities dependent on both time step and observation event (matrix)

Expanding these possibilities gives $2 \times 2 \times 3 = 12$ different distributions:

- `dDynOcc_sss`
- `dDynOcc_svs`
- `dDynOcc_vss`
- `dDynOcc_vvs`
- `dDynOcc_ssv`
- `dDynOcc_svv`
- `dDynOcc_vsv`
- `dDynOcc_vvv`
- `dDynOcc_ssm`
- `dDynOcc_svm`
- `dDynOcc_vsm`
- `dDynOcc_vvm`

\   

### Exercise: Update the Occupancy Model using `dOcc` distribution

Now, you'll go ahead and update your version of the occupancy model, to make use of the `dOcc` distribution.

1. Modify the occupancy model code, to use the `dOcc` distribution.  You can get help on this distribution in R, using `help(dOcc)`.

2. Show the posteriors results are the same, using `chainsPlot` or `chainsSummary`.  You can do this easily as:

```{r eval = FALSE}
chainsPlot(list(orig = samples, dOcc = samples2))
```

3. Compare the **efficiencies** for sampling all 4 parameters, using each model.  You'll need to time each MCMC run (you can use `system.time`), and also calculate the effective sample sizes for each parameter, using `effectiveSize` from the `coda` package.


\   

### Results


```{r, echo = FALSE, message = FALSE}
library(nimble, quiet = TRUE)
load('~/github/nimble/nimble-cefe-2019/docs/data/occupancy_samples.Rdata')
```

Here are the results I got for the modified occupancy model:

\  

```{r }
round(samplesSummary(samples2), 2)
```

\   

```{r, fig.height = 2.5}
library(basicMCMCplots)

basicMCMCplots::chainsSummary(list(orig = samples, dOcc = samples2),
                              jitter = 0.3, buffer.left = 0.3, buffer.right = 0.3)
```


```{r }
library(basicMCMCplots)

basicMCMCplots::chainsPlot(list(orig = samples, dOcc = samples2))
```


<!--
#### Efficiency Results:
```{r }
library(coda)

## ESS of 10,000 samples from original occupancy model
(ESS <- apply(samples, 2, effectiveSize))

## time (seconds) to generate 10,000 samples from original occupancy model
time

## ESS of 10,000 samples from dOcc occupancy model
(ESS2 <- apply(samples2, 2, effectiveSize))

## time (seconds) to generate 10,000 samples from dOcc occupancy model
time2

## factor increases in efficiency
(ESS2 / time2) / (ESS / time)
```
-->



\  

\  

\  

\  

\  

\  

\  

\  

\  

\  

\  

\  

\  

\  


